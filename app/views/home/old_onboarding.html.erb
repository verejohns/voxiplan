<!--begin::Authentication - Sign-up -->
<div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed">
  <!--begin::Content-->
  <div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
    <!--begin::Logo-->
    <a href="/" class="mb-12">
      <img alt="Logo" src="/assets/voxi_logo.png" class="h-45px" />
    </a>
    <!--end::Logo-->
    <!--begin::Wrapper-->
    <div class="bg-body rounded shadow-sm p-10 p-lg-15 mx-auto">
      <!--begin::Stepper-->
      <div class="stepper stepper-pills stepper-column d-flex flex-column flex-xl-row flex-row-fluid" id="kt_create_account_stepper">
        <!--begin::Content-->
        <%= form_for(current_client.agenda_apps, as: :agenda_app, :url => save_agenda_info_old_agenda_app_path, method: :post, html: {class: "w-100 w-lg-800px", id: "kt_create_account_form"}) do |f| %>
          <div class="d-flex flex-row-fluid flex-center bg-body rounded">
            <!--begin::Form-->

            <!--begin::Step 2-->
            <div class="w-100 current" data-kt-stepper-element="content">
              <!--begin::Wrapper-->
              <div class="w-100">
                <!--begin::Heading-->
                <div class="pb-10">
                  <% if params[:success].present? && params[:success] == 'false' %>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                      <strong><%= t('onboarding.connect_calendar.auth_failure_title') %></strong> <%= t('onboarding.connect_calendar.auth_failure_content') %>
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                  <% end %>
                  <!--begin::Title-->
                  <h2 class="fw-bolder text-dark"><%= t('onboarding.connect_calendar.title') %></h2>
                  <!--end::Title-->
                  <!--begin::Notice-->
                  <div class="text-muted fw-bold fs-6 mb-3"><%= t('onboarding.connect_calendar.title_description') %></div>
                  <!--end::Notice-->
                  <div class="alert alert-warning d-flex align-items-center p-2">
                    <!--begin::Icon-->
                    <span class="svg-icon svg-icon-2hx svg-icon-warning me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="black" />
                          <rect x="11" y="14" width="7" height="2" rx="1" transform="rotate(-90 11 14)" fill="black" />
                          <rect x="11" y="17" width="2" height="2" rx="1" transform="rotate(-90 11 17)" fill="black" />
                        </svg>
                      </span>
                    <!--end::Icon-->

                    <!--begin::Wrapper-->
                    <div class="d-flex flex-column">
                      <!--begin::Content-->
                      <span class="fw-bold"><%= t('onboarding.connect_calendar.title_warning') %></span>
                      <!--end::Content-->
                    </div>
                    <!--end::Wrapper-->
                  </div>

                  <div class="d-none align-items-center justify-content-center text-center p-2 d-none">
                    <span class="fw-bold"><%= t('onboarding.connect_calendar.calendar_processed_in') %> </span>
                    <span>
          <select name="server_region" id="server_region" class="form-select form-select-sm form-select-transparent w-md-150px">
            <% @server_regions.each do |key, value| %>
              <option value="<%= key %>" <%= key.to_s == @selected_server_region ? 'selected' : '' %>><%= value %> <%= t('onboarding.connect_calendar.region') %></option>
            <% end %>
          </select>
        </span>
                    <span><i class="las la-question-circle fs-2 text-dark pt-1 ms-1" title="<%= raw t('onboarding.connect_calendar.server_region_tooltip') %>" data-bs-html="true" data-bs-toggle="tooltip"></i></span>

                  </div>

                </div>
                <!--end::Heading-->
                <!--begin::Card-->
                <div class="card card-bordered mb-7">
                  <!--begin::Header-->
                  <div class="card-header">
                    <div class="card-title">
                      <div class="me-3"><img src="/assets/onboarding/google-icon.svg" alt="Google" class="w-30px"></div>
                      <%= t('onboarding.connect_calendar.google_company') %>
                    </div>
                  </div>
                  <!--end::Header-->
                  <!--begin::Body-->
                  <div class="card-body">
                    <!--begin::Card-->
                    <div class="card card-dashed flex-row flex-stack flex-wrap p-6">
                      <!--begin::Info-->
                      <div class="d-flex flex-column py-2">
                        <!--begin::Wrapper-->
                        <div class="d-flex align-items-center">
                          <!--begin::Icon-->
                          <img src="/assets/onboarding/google-calendar.svg" alt="Google Calendar" class="w-50px me-4">
                          <!--end::Icon-->
                          <!--begin::Details-->
                          <div>
                            <div class="fs-4 fw-bolder"><%= t('onboarding.connect_calendar.google') %></div>
                            <div class="fs-6 fw-bold text-gray-400"><%= t('onboarding.connect_calendar.google_detail') %></div>
                          </div>
                          <!--end::Details-->
                        </div>
                        <!--end::Wrapper-->
                      </div>
                      <!--end::Info-->
                      <!--begin::Actions-->
                      <div class="d-flex align-items-center py-2">
                        <button type="button" data-provider-name="google" class="btn btn-sm btn-light btn-active-light-primary btn-connect <%= params[:provider_name].present? && params[:provider_name] == 'google' ? 'active disabled' : (params[:success].present? && params[:success] == "true" ? 'disabled' : '') %>">
                          <%= raw params[:provider_name].present? && params[:provider_name] == 'google' ? '<i class="fas fa-check"></i>' : '' %> <%= t('common.button.connect') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Card-->
                  </div>
                  <!--end::Body-->
                </div>

                <div class="card card-bordered mb-7">
                  <!--begin::Header-->
                  <div class="card-header">
                    <div class="card-title">
                      <div class="me-3">
                        <img src="/assets/onboarding/microsoft-5.svg" alt="Microsoft" class="w-30px">
                      </div>
                      <%= t('onboarding.connect_calendar.microsoft_company') %>
                    </div>
                  </div>
                  <!--end::Header-->
                  <!--begin::Body-->
                  <div class="card-body">
                    <!--begin::Card-->
                    <div class="card card-dashed flex-row flex-stack flex-wrap p-6 mb-4">
                      <!--begin::Info-->
                      <div class="d-flex flex-column py-2">
                        <!--begin::Wrapper-->
                        <div class="d-flex align-items-center">
                          <!--begin::Icon-->
                          <img src="/assets/onboarding/office-365-calendar.svg" alt="Office 365 Calendar" class="w-50px me-4">
                          <!--end::Icon-->
                          <!--begin::Details-->
                          <div>
                            <div class="fs-4 fw-bolder"><%= t('onboarding.connect_calendar.office_365') %></div>
                            <div class="fs-6 fw-bold text-gray-400"><%= t('onboarding.connect_calendar.office_365_detail') %></div>
                          </div>
                          <!--end::Details-->
                        </div>
                        <!--end::Wrapper-->
                      </div>
                      <!--end::Info-->
                      <!--begin::Actions-->
                      <div class="d-flex align-items-center py-2">
                        <button type="button" data-provider-name="office365" class="btn btn-sm btn-light btn-active-light-primary btn-connect <%= params[:provider_name].present? && params[:provider_name] == 'office365' ? 'active disabled' : (params[:success].present? && params[:success] == "true" ? 'disabled' : '') %>">
                          <%= raw params[:provider_name].present? && params[:provider_name] == 'office365' ? '<i class="fas fa-check"></i>' : '' %> <%= t('common.button.connect') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Card-->
                    <!--begin::Card-->
                    <div class="card card-dashed flex-row flex-stack flex-wrap p-6 mb-4">
                      <!--begin::Info-->
                      <div class="d-flex flex-column py-2">
                        <!--begin::Wrapper-->
                        <div class="d-flex align-items-center">
                          <!--begin::Icon-->
                          <img src="/assets/onboarding/exchange-calendar.svg" alt="Exchange Calendar" class="w-50px me-4">
                          <!--end::Icon-->
                          <!--begin::Details-->
                          <div>
                            <div class="fs-4 fw-bolder"><%= t('onboarding.connect_calendar.exchange') %></div>
                            <div class="fs-6 fw-bold text-gray-400"><%= t('onboarding.connect_calendar.exchange_detail') %></div>
                          </div>
                          <!--end::Details-->
                        </div>
                        <!--end::Wrapper-->
                      </div>
                      <!--end::Info-->
                      <!--begin::Actions-->
                      <div class="d-flex align-items-center py-2">
                        <button type="button" data-provider-name="exchange" class="btn btn-sm btn-light btn-active-light-primary btn-connect <%= params[:provider_name].present? && params[:provider_name] == 'exchange' ? 'active disabled' : (params[:success].present? && params[:success] == "true" ? 'disabled' : '') %>">
                          <%= raw params[:provider_name].present? && params[:provider_name] == 'exchange' ? '<i class="fas fa-check"></i>' : '' %> <%= t('common.button.connect') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Card-->
                    <!--begin::Card-->
                    <div class="card card-dashed flex-row flex-stack flex-wrap p-6">
                      <!--begin::Info-->
                      <div class="d-flex flex-column py-2">
                        <!--begin::Wrapper-->
                        <div class="d-flex align-items-center">
                          <!--begin::Icon-->
                          <img src="/assets/onboarding/outlook-plug-in.svg" alt="Outlook Plug-In" class="w-50px me-4">
                          <!--end::Icon-->
                          <!--begin::Details-->
                          <div>
                            <div class="fs-4 fw-bolder"><%= t('onboarding.connect_calendar.outlook') %></div>
                            <div class="fs-6 fw-bold text-gray-400"><%= t('onboarding.connect_calendar.outlook_detail') %></div>
                          </div>
                          <!--end::Details-->
                        </div>
                        <!--end::Wrapper-->
                      </div>
                      <!--end::Info-->
                      <!--begin::Actions-->
                      <div class="d-flex align-items-center py-2">
                        <button type="button" data-provider-name="live_connect" class="btn btn-sm btn-light btn-active-light-primary btn-connect <%= params[:provider_name].present? && params[:provider_name] == 'live_connect' ? 'active disabled' : (params[:success].present? && params[:success] == "true" ? 'disabled' : '') %>">
                          <%= raw params[:provider_name].present? && params[:provider_name] == 'live_connect' ? '<i class="fas fa-check"></i>' : '' %> <%= t('common.button.connect') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Card-->
                  </div>
                  <!--end::Body-->
                </div>

                <div class="card card-bordered mb-7">
                  <!--begin::Header-->
                  <div class="card-header">
                    <div class="card-title">
                      <div class="me-3">
                        <img src="/assets/onboarding/apple-black.svg" alt="Apple" class="w-30px">
                      </div>
                      <%= t('onboarding.connect_calendar.apple_company') %>
                    </div>
                  </div>
                  <!--end::Header-->
                  <!--begin::Body-->
                  <div class="card-body">
                    <!--begin::Card-->
                    <div class="card card-dashed flex-row flex-stack flex-wrap p-6">
                      <!--begin::Info-->
                      <div class="d-flex flex-column py-2">
                        <!--begin::Wrapper-->
                        <div class="d-flex align-items-center">
                          <!--begin::Icon-->
                          <img src="/assets/onboarding/icloud-calendar.svg" alt="iCloud Calendar" class="w-50px me-4">
                          <!--end::Icon-->
                          <!--begin::Details-->
                          <div>
                            <div class="fs-4 fw-bolder"><%= t('onboarding.connect_calendar.icloud') %></div>
                            <div class="fs-6 fw-bold text-gray-400"><%= t('onboarding.connect_calendar.icloud_detail') %></div>
                          </div>
                          <!--end::Details-->
                        </div>
                        <!--end::Wrapper-->
                      </div>
                      <!--end::Info-->
                      <!--begin::Actions-->
                      <div class="d-flex align-items-center py-2">
                        <button type="button" data-provider-name="apple" class="btn btn-sm btn-light btn-active-light-primary btn-connect <%= params[:provider_name].present? && params[:provider_name] == 'apple' ? 'active disabled' : (params[:success].present? && params[:success] == "true" ? 'disabled' : '') %>">
                          <%= raw params[:provider_name].present? && params[:provider_name] == 'apple' ? '<i class="fas fa-check"></i>' : '' %> <%= t('common.button.connect') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Card-->
                  </div>
                </div>
              </div>

              <input type="hidden" name="cronofy_access_token" value="<%= params[:access_token].present? ? params[:access_token] : "" %>" />
              <input type="hidden" name="cronofy_refresh_token" value="<%= params[:refresh_token].present? ? params[:refresh_token] : "" %>" />
              <input type="hidden" name="cronofy_profile_id" value="<%= params[:profile_id].present? ? params[:profile_id] : "" %>" />
              <input type="hidden" name="cronofy_profile_name" value="<%= params[:profile_name].present? ? params[:profile_name] : "" %>" />
              <input type="hidden" name="cronofy_provider_name" value="<%= params[:provider_name].present? ? params[:provider_name] : "" %>" />
              <input type="hidden" name="cronofy_account_id" value="<%= params[:account_id].present? ? params[:account_id] : "" %>" />
              <input type="hidden" name="agenda_id" value="<%= params[:agenda_id].present? ? params[:agenda_id] : "" %>" />
            </div>
            <!--end::Step 2-->
          </div>
          <!--begin::Actions-->
          <div class="d-flex flex-stack pt-10 justify-content-end">
            <!--begin::Wrapper-->
            <% if params[:provider_name].present? %>
              <button type="submit" class="btn btn-lg btn-primary" data-kt-stepper-action="next">
                <%= t('common.button.continue') %>
              </button>
            <% else %>
              <a href="<%=set_server_region_path %>" class="btn btn-lg btn-primary" data-kt-stepper-action="next" id="skip_connect">
                <%= t('common.button.skip') %>
              </a>
            <% end %>
            <!--end::Wrapper-->
          </div>
          <!--end::Actions-->
        <% end %>
        <!--end::Form-->
        <!--end::Content-->
      </div>
      <!--end::Stepper-->
    </div>
    <!--end::Wrapper-->
  </div>
  <!--end::Content-->
</div>
<!--begin::Page Custom Javascript(used by this page)-->
<script>
    $('input').keydown(function(event){
        if(event.keyCode == 13) {
            event.preventDefault();
            return false;
        }
    });

    $('button.btn-connect').on('click', function() {
        const provider_name = $(this).data('provider-name');
        const auth = $('[name="csrf-token"]')[0].content;
        $.ajax({
            url: "/agenda_app/create_new_agenda",
            type: "POST",
            data: {
                authenticity_token: auth,
                browser_locale: "<%= @browser_locale %>"
            },
            success: function(response){
                window.location.href = response.cronofy_auth_url + "&provider_name=" + provider_name + "&state=<%= SecureRandom.hex(24) %>" + "&locale=" + response.user_locale;
            }
        });
    });
</script>
<!--end::Page Custom Javascript-->
<!--end::Javascript-->
</body>
<!--end::Body-->
</html>