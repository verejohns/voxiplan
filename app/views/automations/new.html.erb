<div class="toolbar" id="kt_toolbar">
  <!--begin::Container-->
  <div id="kt_toolbar_container" class="container-fluid d-flex flex-stack">
    <!--begin::Page title-->
    <div data-kt-swapper="true" data-kt-swapper-mode="prepend" data-kt-swapper-parent="{default: '#kt_content_container', 'lg': '#kt_toolbar_container'}" class="page-title d-flex align-items-center flex-wrap me-3 mb-5 mb-lg-0">
      <a class="btn btn-sm btn-outline btn-outline-primary btn-color-primary btn-active-color-white me-4" href="<%= automations_path %>">
        <!--begin::Svg Icon | path: icons/duotone/Navigation/Close.svg-->
        <span class="svg-icon svg-icon-2">
											<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
												<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
													<polygon points="0 0 24 0 24 24 0 24"></polygon>
													<rect fill="#000000" opacity="0.3" transform="translate(15.000000, 12.000000) scale(-1, 1) rotate(-90.000000) translate(-15.000000, -12.000000) " x="14" y="7" width="2" height="10" rx="1"></rect>
													<path d="M3.7071045,15.7071045 C3.3165802,16.0976288 2.68341522,16.0976288 2.29289093,15.7071045 C1.90236664,15.3165802 1.90236664,14.6834152 2.29289093,14.2928909 L8.29289093,8.29289093 C8.67146987,7.914312 9.28105631,7.90106637 9.67572234,8.26284357 L15.6757223,13.7628436 C16.0828413,14.136036 16.1103443,14.7686034 15.7371519,15.1757223 C15.3639594,15.5828413 14.7313921,15.6103443 14.3242731,15.2371519 L9.03007346,10.3841355 L3.7071045,15.7071045 Z"
                            fill="#000000" fill-rule="nonzero" transform="translate(9.000001, 11.999997) scale(-1, -1) rotate(90.000000) translate(-9.000001, -11.999997) "></path>
												</g>
											</svg>
										</span>
        <!--end::Svg Icon-->
        Back
      </a>
      <!--begin::Title-->
      <h1 class="d-flex align-items-center text-dark fw-bolder my-1 fs-3"></h1>
      <!--end::Title-->
    </div>
    <!--end::Page title-->
    <!--begin::Actions-->
    <div class="d-flex align-items-center py-1"></div>
    <!--end::Actions-->
  </div>
  <!--end::Container-->
</div>
<!--end::Toolbar-->

<!--begin::Post-->
<div class="post d-flex flex-column-fluid" id="kt_post">
  <!--begin::Container-->
  <div id="kt_content_container" class="container mw-800px">
    <input type="hidden" name="automation_type" />
    <input type="hidden" name="email_invitee_subject" />
    <input type="hidden" name="email_invitee_body" />
    <input type="hidden" name="email_host_subject" />
    <input type="hidden" name="email_host_body" />
    <input type="hidden" name="sms_invitee_body"  />
    <input type="hidden" name="sms_host_body"  />
    <input type="hidden" name="sms_invitee_switch_value"  />

    <div class="row">
      <div class="col-md-12">
        <!--begin::Field-->
        <div class="mb-7">
          <label class="form-label"><%= t('services.automations.edit_automation.name') %></label>
          <input class="form-control" type="text" name="automation_name" value="" >
        </div>
        <!--end::Field-->
      </div>
      <div class="col-md-12">
        <!--begin::Field-->
        <div class="mb-7">
          <label class="form-label"><%= t('services.automations.edit_automation.filter') %></label>
          <select id="automation_filters" name="automation_filters" class="form-select" multiple data-placeholder="Select...">
            <optgroup label="<%= t('services.automations.edit_automation.service') %>">
              <option value="services_0" data-select2-group="service"><%= t('services.automations.edit_automation.all_services') %></option>

            </optgroup>
            <optgroup label="<%= t('services.automations.edit_automation.channel') %>">
              <option value="channel_booking_widget" data-select2-group="channel"><%= t('services.automations.edit_automation.booking_widget') %></option>
              <option value="channel_booking_phone" data-select2-group="channel"><%= t('services.automations.edit_automation.phone') %></option>
            </optgroup>
            <optgroup label="<%= t('services.automations.edit_automation.resource') %>">
              <option value="resources_0" data-select2-group="resource"><%= t('services.automations.edit_automation.all_resources') %></option>
              <option value="resources_1" data-select2-group="resource">Evangeline Cure</option>
              <option value="resources_2" data-select2-group="resource">Mike Myers</option>
            </optgroup>
            <optgroup label="<%= t('services.automations.edit_automation.invitee') %>">
              <option value="invitee_1" data-select2-group="invitee">New invitee</option>
              <option value="invitee_2" data-select2-group="invitee">Existing invitee</option>
            </optgroup>
          </select>
        </div>
        <!--end::Field-->
      </div>
    </div>

    <div class="card card-bordered">
      <div class="card-header">
        <h3 class="card-title"><%= t('services.automations.edit_automation.trigger') %></h3>
      </div>
      <div class="card-body">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <span class="fw-bold fs-5 trigger-event-value">New event is scheduled</span>
              </div>
              <div class="d-flex align-items-center">
                <a href="#kt_modal_edit_trigger" class="ms-2 trigger-edit-icon" data-bs-toggle="modal">
                  <!--begin::Svg Icon | path: icons/duotone/Design/Edit.svg-->
                  <span class="svg-icon svg-icon-2x svg-icon-info">
															<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																<path d="M8,17.9148182 L8,5.96685884 C8,5.56391781 8.16211443,5.17792052 8.44982609,4.89581508 L10.965708,2.42895648 C11.5426798,1.86322723 12.4640974,1.85620921 13.0496196,2.41308426 L15.5337377,4.77566479 C15.8314604,5.0588212 16,5.45170806 16,5.86258077 L16,17.9148182 C16,18.7432453 15.3284271,19.4148182 14.5,19.4148182 L9.5,19.4148182 C8.67157288,19.4148182 8,18.7432453 8,17.9148182 Z"
                                      fill="#000000" fill-rule="nonzero" transform="translate(12.000000, 10.707409) rotate(-135.000000) translate(-12.000000, -10.707409) "></path>
																<rect fill="#000000" opacity="0.3" x="5" y="20" width="15" height="2" rx="1"></rect>
															</svg>
														</span>
                  <!--end::Svg Icon-->
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center my-5">
      <!--begin::Svg Icon | path: assets/media/icons/duotune/arrows/arr004.svg-->
      <span class="svg-icon svg-icon-3x">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
										<path d="M13 14.4V3C13 2.4 12.6 2 12 2C11.4 2 11 2.4 11 3V14.4H13Z" fill="currentColor"/>
										<path opacity="0.3" d="M4 14.4H20L12.7 21.7C12.3 22.1 11.7 22.1 11.3 21.7L4 14.4Z" fill="currentColor"/>
									</svg>
								</span>
      <!--end::Svg Icon-->
    </div>

    <div class="card card-bordered">
      <div class="card-header">
        <h3 class="card-title"><%= t('services.automations.edit_automation.action') %></h3>
      </div>
      <div class="card-body">
        <div class="card shadow-sm mb-7 send_email_invitee">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <!--begin::Svg Icon-->
                <span class="svg-icon svg-icon-3x svg-icon-primary me-3">
														<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" >
															<path opacity="0.3" d="M21 19H3C2.4 19 2 18.6 2 18V6C2 5.4 2.4 5 3 5H21C21.6 5 22 5.4 22 6V18C22 18.6 21.6 19 21 19Z" fill="currentColor"/>
															<path d="M21 5H2.99999C2.69999 5 2.49999 5.10005 2.29999 5.30005L11.2 13.3C11.7 13.7 12.4 13.7 12.8 13.3L21.7 5.30005C21.5 5.10005 21.3 5 21 5Z"
                                    fill="currentColor" />
														</svg>
													</span>
                <!--end::Svg Icon-->
                <span class="fw-bold fs-5"><%= t('services.automations.edit_automation.email_invitee') %></span>
              </div>
              <div class="d-flex align-items-center">
                <a href="#kt_modal_edit_action_email" class="ms-2 action_email_invitee" data-bs-toggle="modal">
                  <!--begin::Svg Icon | path: icons/duotone/Design/Edit.svg-->
                  <span class="svg-icon svg-icon-2x svg-icon-info">
															<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
																<path d="M8,17.9148182 L8,5.96685884 C8,5.56391781 8.16211443,5.17792052 8.44982609,4.89581508 L10.965708,2.42895648 C11.5426798,1.86322723 12.4640974,1.85620921 13.0496196,2.41308426 L15.5337377,4.77566479 C15.8314604,5.0588212 16,5.45170806 16,5.86258077 L16,17.9148182 C16,18.7432453 15.3284271,19.4148182 14.5,19.4148182 L9.5,19.4148182 C8.67157288,19.4148182 8,18.7432453 8,17.9148182 Z"
                                      fill="#000000" fill-rule="nonzero" transform="translate(12.000000, 10.707409) rotate(-135.000000) translate(-12.000000, -10.707409) "></path>
																<rect fill="#000000" opacity="0.3" x="5" y="20" width="15" height="2" rx="1"></rect>
															</svg>
														</span>
                  <!--end::Svg Icon-->
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="card shadow-sm mb-7 send_sms_invitee">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <!--begin::Svg Icon-->
                <span class="svg-icon svg-icon-3x svg-icon-primary me-3">
														<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
															<path opacity="0.3" d="M2 4V16C2 16.6 2.4 17 3 17H13L16.6 20.6C17.1 21.1 18 20.8 18 20V17H21C21.6 17 22 16.6 22 16V4C22 3.4 21.6 3 21 3H3C2.4 3 2 3.4 2 4Z" fill="currentColor" />
															<path d="M18 9H6C5.4 9 5 8.6 5 8C5 7.4 5.4 7 6 7H18C18.6 7 19 7.4 19 8C19 8.6 18.6 9 18 9ZM16 12C16 11.4 15.6 11 15 11H6C5.4 11 5 11.4 5 12C5 12.6 5.4 13 6 13H15C15.6 13 16 12.6 16 12Z" fill="currentColor"/>
														</svg>
													</span>
                <!--end::Svg Icon-->
                <span class="fw-bold fs-5"><%= t('services.automations.edit_automation.sms_invitee') %></span>
              </div>
              <div class="d-flex align-items-center">
                <a href="#kt_modal_edit_action_sms" class="ms-2 action_sms_invitee" data-bs-toggle="modal">
                  <!--begin::Svg Icon-->
                  <span class="svg-icon svg-icon-2x svg-icon-info">
															<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" >
																<path d="M8,17.9148182 L8,5.96685884 C8,5.56391781 8.16211443,5.17792052 8.44982609,4.89581508 L10.965708,2.42895648 C11.5426798,1.86322723 12.4640974,1.85620921 13.0496196,2.41308426 L15.5337377,4.77566479 C15.8314604,5.0588212 16,5.45170806 16,5.86258077 L16,17.9148182 C16,18.7432453 15.3284271,19.4148182 14.5,19.4148182 L9.5,19.4148182 C8.67157288,19.4148182 8,18.7432453 8,17.9148182 Z"
                                      fill="#000000" fill-rule="nonzero" transform="translate(12.000000, 10.707409) rotate(-135.000000) translate(-12.000000, -10.707409) "></path>
																<rect fill="#000000" opacity="0.3" x="5" y="20" width="15" height="2" rx="1"></rect>
															</svg>
														</span>
                  <!--end::Svg Icon-->
                </a>
                <a href="javascript:void(0)" class="ms-2 remove-action-sms" >
                  <!--begin::Svg Icon-->
                  <span class="svg-icon svg-icon-2x svg-icon-danger">
															<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24"version="1.1">
																<path d="M5 9C5 8.44772 5.44772 8 6 8H18C18.5523 8 19 8.44772 19 9V18C19 19.6569 17.6569 21 16 21H8C6.34315 21 5 19.6569 5 18V9Z" fill="currentColor"/>
																<path opacity="0.5" d="M5 5C5 4.44772 5.44772 4 6 4H18C18.5523 4 19 4.44772 19 5V5C19 5.55228 18.5523 6 18 6H6C5.44772 6 5 5.55228 5 5V5Z" fill="currentColor"/>
																<path opacity="0.5" d="M9 4C9 3.44772 9.44772 3 10 3H14C14.5523 3 15 3.44772 15 4V4H9V4Z" fill="currentColor"/>
															</svg>
														</span>
                  <!--end::Svg Icon-->
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center add_new_action_button">
          <a href="#kt_modal_add_new_action" class="btn btn-primary" data-bs-toggle="modal">
            <i class="fas fa-plus"></i><%= t('services.automations.edit_automation.add_new_action') %>
          </a>
        </div>
      </div>
    </div>
  </div>
  <!--end::Container-->
</div>
<!--end::Post-->

<%= javascript_include_tag 'plugins/tinymce/tinymce.bundle', 'data-turbolinks-track' => true  %>
<%= javascript_include_tag 'plugins/sms-counter/sms-counter.bundle', 'data-turbolinks-track' => true  %>

<%= render 'automations/trigger_modal' %>
<%= render 'automations/action_email' %>
<%= render 'automations/action_sms' %>

<script>
    (function () {
        const template = function (item) {
            if (!item.id) return item.text;
            if (item.element.parentNode && item.element.parentNode.nodeName.toLowerCase() === 'optgroup' && item.element.parentNode.label) {
                return `${item.element.parentNode.label}: ${item.text}`;
            }
        }

        $('select#automation_filters').select2({
            templateSelection: template
        });
    })();
</script>