<%= stylesheet_link_tag    'datatables.bundle', media: 'all', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'datatables.bundle', 'data-turbolinks-track' => true %>

<!--begin::Toolbar-->
<div
  class="toolbar"
  id="kt_toolbar"
>
  <!--begin::Container-->
  <div
    id="kt_toolbar_container"
    class="container-fluid d-flex flex-stack"
  >
    <!--begin::Page title-->
    <div
      data-kt-swapper="true"
      data-kt-swapper-mode="prepend"
      data-kt-swapper-parent="{default: '#kt_content_container', 'lg': '#kt_toolbar_container'}"
      class="page-title d-flex align-items-center flex-wrap me-3 mb-5 mb-lg-0"
    >
      <!--begin::Title-->
      <h1 class="d-flex align-items-center text-dark fw-bolder my-1 fs-3"><%= t('organization.title') %></h1>
      <!--end::Title-->
    </div>
    <!--end::Page title-->
    <!--begin::Actions-->
    <div class="d-flex align-items-center py-1"></div>
    <!--end::Actions-->
  </div>
  <!--end::Container-->
</div>
<!--end::Toolbar-->
<!--begin::Post-->
<div
  class="post d-flex flex-column-fluid"
  id="kt_post"
>
  <!--begin::Container-->
  <div
    id="kt_content_container"
    class="container-fluid"
  >
    <!--begin::Tab content-->
    <div class="tab-content">
      <!--begin::Tab panel-->
      <div
        id="kt_tab_pane_team_members_active"
        class="tab-pane fade show active"
        role="tabpanel"
      >
        <!--begin::Card-->
        <div class="card">
          <!--begin::Card header-->
          <div class="card-header border-0 pt-6 justify-content-end">
            <!--begin::Card title-->
            <div class="card-title d-none">
              <!--begin::Search-->
              <div class="d-flex align-items-center position-relative my-1">
                <!--begin::Svg Icon | path: icons/duotone/General/Search.svg-->
                <span class="svg-icon svg-icon-1 position-absolute ms-6">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    width="24px"
                    height="24px"
                    viewBox="0 0 24 24"
                    version="1.1"
                  >
                    <g
                      stroke="none"
                      stroke-width="1"
                      fill="none"
                      fill-rule="evenodd"
                    >
                      <rect
                        x="0"
                        y="0"
                        width="24"
                        height="24"
                        />
                      <path
                        d="M14.2928932,16.7071068 C13.9023689,16.3165825 13.9023689,15.6834175 14.2928932,15.2928932 C14.6834175,14.9023689 15.3165825,14.9023689 15.7071068,15.2928932 L19.7071068,19.2928932 C20.0976311,19.6834175 20.0976311,20.3165825 19.7071068,20.7071068 C19.3165825,21.0976311 18.6834175,21.0976311 18.2928932,20.7071068 L14.2928932,16.7071068 Z"
                        fill="#000000"
                        fill-rule="nonzero"
                        opacity="0.3"
                        />
                      <path
                        d="M11,16 C13.7614237,16 16,13.7614237 16,11 C16,8.23857625 13.7614237,6 11,6 C8.23857625,6 6,8.23857625 6,11 C6,13.7614237 8.23857625,16 11,16 Z M11,18 C7.13400675,18 4,14.8659932 4,11 C4,7.13400675 7.13400675,4 11,4 C14.8659932,4 18,7.13400675 18,11 C18,14.8659932 14.8659932,18 11,18 Z"
                        fill="#000000"
                        fill-rule="nonzero"
                        />
                    </g>
                  </svg>
                </span>
                <!--end::Svg Icon-->
                <input
                  type="text"
                  class="form-control form-control-solid w-250px ps-14"
                  placeholder="<%= t('organization.placeholder.search') %>"
                  data-kt-user-table-filter="search"
                />
              </div>
              <!--end::Search-->
            </div>
            <!--begin::Card title-->
            <!--begin::Card toolbar-->
            <div class="card-toolbar">

              <!--begin::Toolbar-->
              <div
                class="d-flex justify-content-end"
                data-kt-user-table-toolbar="base"
              >
                <!--begin::Wrapper-->
                <div class="me-3 d-none">
                  <button
                    type="button"
                    class="btn btn-light-primary"
                    data-kt-menu-trigger="click"
                    data-kt-menu-placement="bottom-end"
                    data-kt-menu-flip="top-end"
                  >
                    <!--begin::Svg Icon | path: icons/duotone/Text/Filter.svg-->
                    <span class="svg-icon svg-icon-2">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="24px"
                        height="24px"
                        viewBox="0 0 24 24"
                        version="1.1"
                      >
                        <g
                          stroke="none"
                          stroke-width="1"
                          fill="none"
                          fill-rule="evenodd"
                        >
                          <rect
                            x="0"
                            y="0"
                            width="24"
                            height="24"
                            />
                          <path
                            d="M5,4 L19,4 C19.2761424,4 19.5,4.22385763 19.5,4.5 C19.5,4.60818511 19.4649111,4.71345191 19.4,4.8 L14,12 L14,20.190983 C14,20.4671254 13.7761424,20.690983 13.5,20.690983 C13.4223775,20.690983 13.3458209,20.6729105 13.2763932,20.6381966 L10,19 L10,12 L4.6,4.8 C4.43431458,4.5790861 4.4790861,4.26568542 4.7,4.1 C4.78654809,4.03508894 4.89181489,4 5,4 Z"
                            fill="#000000"
                            />
                        </g>
                      </svg>
                    </span>
                    <!--end::Svg Icon-->
                    <%= t('organization.filter.title') %>
                  </button>
                  <!--begin::Menu-->
                  <div
                    class="menu menu-sub menu-sub-dropdown w-300px w-md-325px"
                    data-kt-menu="true"
                  >
                    <!--begin::Header-->
                    <div class="px-7 py-5">
                      <div class="fs-5 text-dark fw-bolder"><%= t('organization.filter.options') %></div>
                    </div>
                    <!--end::Header-->
                    <!--begin::Separator-->
                    <div class="separator border-gray-200"></div>
                    <!--end::Separator-->
                    <!--begin::Content-->
                    <div
                      class="px-7 py-5"
                      data-kt-user-table-filter="form"
                    >
                      <!--begin::Input group-->
                      <div class="mb-10">
                        <label class="form-label fs-6 fw-bold"><%= t('organization.filter.label.role') %>:</label>
                        <select
                          class="form-select form-select-solid fw-bolder"
                          data-kt-select2="true"
                          data-placeholder="<%= t('organization.filter.placeholder') %>"
                          data-allow-clear="true"
                          data-kt-user-table-filter="role"
                          data-hide-search="true"
                        >
                          <option></option>
                          <option value="User">User</option>
                          <option value="Admin">Admin</option>
                          <option value="Owner">Owner</option>
                        </select>
                      </div>
                      <!--end::Input group-->
                      <!--begin::Input group-->
                      <div class="mb-10">
                        <label class="form-label fs-6 fw-bold"><%= t('organization.filter.label.group') %>:</label>
                        <select
                          class="form-select form-select-solid fw-bolder"
                          data-kt-select2="true"
                          data-placeholder="<%= t('organization.filter.placeholder') %>"
                          data-allow-clear="true"
                          data-kt-user-table-filter="group"
                          data-hide-search="true"
                        >
                          <option></option>
                          <option value="Sales">Sales</option>
                          <option value="Customer Success">Customer Success</option>
                          <option value="Engineering">Engineering</option>
                        </select>
                      </div>
                      <!--end::Input group-->
                      <!--begin::Actions-->
                      <div class="d-flex justify-content-end">
                        <button
                          type="reset"
                          class="btn btn-light btn-active-light-primary fw-bold me-2 px-6"
                          data-kt-menu-dismiss="true"
                          data-kt-user-table-filter="reset"
                        >
                          <%= t('organization.filter.button.reset') %>
                        </button>
                        <button
                          type="submit"
                          class="btn btn-primary fw-bold px-6"
                          data-kt-menu-dismiss="true"
                          data-kt-user-table-filter="filter"
                        >
                          <%= t('organization.filter.button.apply') %>
                        </button>
                      </div>
                      <!--end::Actions-->
                    </div>
                    <!--end::Content-->
                  </div>
                  <!--end::Menu-->
                </div>
                <!--end::Wrapper-->
                <!--begin::Export-->
                <button
                  type="button"
                  class="btn btn-light-primary me-3 d-none"
                >
                  <!--begin::Svg Icon | path: icons/duotone/Files/Export.svg-->
                  <span class="svg-icon svg-icon-2">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="24px"
                        height="24px"
                        viewBox="0 0 24 24"
                        version="1.1"
                      >
                        <g
                          stroke="none"
                          stroke-width="1"
                          fill="none"
                          fill-rule="evenodd"
                        >
                          <rect
                            x="0"
                            y="0"
                            width="24"
                            height="24"
                            />
                          <path
                            d="M17,8 C16.4477153,8 16,7.55228475 16,7 C16,6.44771525 16.4477153,6 17,6 L18,6 C20.209139,6 22,7.790861 22,10 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,9.99305689 C2,7.7839179 3.790861,5.99305689 6,5.99305689 L7.00000482,5.99305689 C7.55228957,5.99305689 8.00000482,6.44077214 8.00000482,6.99305689 C8.00000482,7.54534164 7.55228957,7.99305689 7.00000482,7.99305689 L6,7.99305689 C4.8954305,7.99305689 4,8.88848739 4,9.99305689 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,10 C20,8.8954305 19.1045695,8 18,8 L17,8 Z"
                            fill="#000000"
                            fill-rule="nonzero"
                            opacity="0.3"
                            />
                          <rect
                            fill="#000000"
                            opacity="0.3"
                            transform="translate(12.000000, 8.000000) scale(1, -1) rotate(-180.000000) translate(-12.000000, -8.000000)"
                            x="11"
                            y="2"
                            width="2"
                            height="12"
                            rx="1"
                            />
                          <path
                            d="M12,2.58578644 L14.2928932,0.292893219 C14.6834175,-0.0976310729 15.3165825,-0.0976310729 15.7071068,0.292893219 C16.0976311,0.683417511 16.0976311,1.31658249 15.7071068,1.70710678 L12.7071068,4.70710678 C12.3165825,5.09763107 11.6834175,5.09763107 11.2928932,4.70710678 L8.29289322,1.70710678 C7.90236893,1.31658249 7.90236893,0.683417511 8.29289322,0.292893219 C8.68341751,-0.0976310729 9.31658249,-0.0976310729 9.70710678,0.292893219 L12,2.58578644 Z"
                            fill="#000000"
                            fill-rule="nonzero"
                            transform="translate(12.000000, 2.500000) scale(1, -1) translate(-12.000000, -2.500000)"
                            />
                        </g>
                      </svg>
                  </span>
                  <!--end::Svg Icon-->
                  <%= t('organization.export') %>
                </button>
                <!--end::Export-->
                <!--begin::Add user-->
                <button
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#kt_modal_add_user"
                >
                  <!--begin::Svg Icon | path: icons/duotone/Navigation/Plus.svg-->
                  <span class="svg-icon svg-icon-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink"
                      width="24px"
                      height="24px"
                      viewBox="0 0 24 24"
                      version="1.1"
                    >
                      <rect
                        fill="#000000"
                        x="4"
                        y="11"
                        width="16"
                        height="2"
                        rx="1"
                        />
                      <rect
                        fill="#000000"
                        opacity="0.5"
                        transform="translate(12.000000, 12.000000) rotate(-270.000000) translate(-12.000000, -12.000000)"
                        x="4"
                        y="11"
                        width="16"
                        height="2"
                        rx="1"
                        />
                    </svg>
                  </span>
                  <!--end::Svg Icon-->
                  <%= t('organization.add_user') %>
                </button>
                <!--end::Add user-->
              </div>
              <!--end::Toolbar-->
              <!--begin::Group actions-->
              <div
                class="d-flex justify-content-end align-items-center d-none"
                data-kt-user-table-toolbar="selected"
              >
                <div class="fw-bolder me-5">
                  <span
                    class="me-2"
                    data-kt-user-table-select="selected_count"
                  ></span>
                  <%= t('organization.selected') %>
                </div>
                <a
                  href="#kt_modal_user_change_role"
                  class="btn btn-light me-2 d-none"
                  data-bs-toggle="modal"
                >
                  <%= t('organization.change_role') %>
                </a>
                <a
                  href="javascript:;"
                  class="btn btn-light me-2"
                  data-bs-toggle="modal"
                >
                  <%=  t('organization.disable_calendar') %>
                </a>
                <button
                  type="button"
                  class="btn btn-danger"
                  data-kt-user-table-select="delete_selected"
                >
                  <%= t('organization.remove') %>
                </button>
              </div>
              <!--end::Group actions-->
            </div>
            <!--end::Card toolbar-->
          </div>
          <!--end::Card header-->
          <!--begin::Card body-->
          <div class="card-body pt-0">
            <!--begin::Table-->
            <table
              class="table align-middle table-row-dashed fs-6 gy-5"
              id="kt_table_team_members_active"
            >
              <!--begin::Table head-->
              <thead>
              <!--begin::Table row-->
              <tr class="text-start text-muted fw-bolder fs-7 text-uppercase gs-0">
                <th class="w-10px pe-2">
                  <div class="form-check form-check-sm form-check-custom form-check-solid me-3">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      data-kt-check="true"
                      data-kt-check-target="#kt_table_team_members_active .form-check-input"
                      value="1"
                      />
                  </div>
                </th>
                <th class="min-w-125px"><%= t('organization.thead.name') %></th>
                <th class="min-w-125px"><%= t('organization.thead.email') %></th>
                <th class="min-w-125px"><%= t('organization.thead.role') %></th>
                <th class="min-w-125px"><%= t('organization.thead.calendar_enabled') %></th>
                <th class="w-10px text-end"></th>
              </tr>
              <!--end::Table row-->
              </thead>
              <!--end::Table head-->
              <!--begin::Table body-->
              <tbody class="text-gray-600 fw-bold">
              <!--begin::Table row-->
              <% @clients.each do |client| %>
                <tr>
                  <td>
                    <div class="form-check form-check-sm form-check-custom form-check-solid">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value="<%= client[:id] %>"
                        />
                    </div>
                  </td>
                  <td>
                    <a
                      href="#"
                      class="text-gray-800 text-hover-primary mb-1"
                    >
                      <%= client[:full_name] %>
                    </a>
                  </td>
                  <td>
                    <%= client[:email] %>
                  </td>
                  <td>
                    <%= checkRelationTuple("/organization-" + session[:current_organization].id.to_s, "owner", "client-" + client[:id].to_s) ? "Owner" : "Member" %>
                  </td>
                  <td>
                    <div class="d-inline-flex align-items-center fw-bold">
                      <span class="svg-icon svg-icon-2hx svg-icon-success me-2 <%= client[:enable_calendar] ? '' : 'd-none' %>">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                        >
                          <rect
                            opacity="0.3"
                            x="2"
                            y="2"
                            width="20"
                            height="20"
                            rx="10"
                            fill="black"
                            />
                          <path
                            d="M10.4343 12.4343L8.75 10.75C8.33579 10.3358 7.66421 10.3358 7.25 10.75C6.83579 11.1642 6.83579 11.8358 7.25 12.25L10.2929 15.2929C10.6834 15.6834 11.3166 15.6834 11.7071 15.2929L17.25 9.75C17.6642 9.33579 17.6642 8.66421 17.25 8.25C16.8358 7.83579 16.1642 7.83579 15.75 8.25L11.5657 12.4343C11.2533 12.7467 10.7467 12.7467 10.4343 12.4343Z"
                            fill="black"
                            />
                        </svg>
                      </span>
                      <span class="svg-icon svg-icon-2hx svg-icon-danger me-2 <%= client[:enable_calendar] ? 'd-none' : '' %>">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                          >
                            <rect
                              opacity="0.3"
                              x="2"
                              y="2"
                              width="20"
                              height="20"
                              rx="10"
                              fill="black"
                              />
                            <rect
                              x="7"
                              y="15.3137"
                              width="12"
                              height="2"
                              rx="1"
                              transform="rotate(-45 7 15.3137)"
                              fill="black"
                              />
                            <rect
                              x="8.41422"
                              y="7"
                              width="12"
                              height="2"
                              rx="1"
                              transform="rotate(45 8.41422 7)"
                              fill="black"
                              />
                          </svg>
                        </span>
                      <%= client[:enable_calendar] ? t('organization.calendar.enabled') : t('organization.calendar.disabled') %>
                    </div>
                  </td>
                  <td class="text-end">
                    <div class="d-inline-block">
                      <button
                        class="btn btn-icon btn-sm btn-light btn-active-light-primary"
                        data-kt-menu-trigger="click"
                        data-kt-menu-placement="bottom-end"
                        data-kt-menu-flip="top-end"
                      >
                        <span class="svg-icon svg-icon-5">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                          >
                            <rect
                              x="10"
                              y="10"
                              width="4"
                              height="4"
                              rx="2"
                              fill="black"
                              />
                            <rect
                              x="10"
                              y="3"
                              width="4"
                              height="4"
                              rx="2"
                              fill="black"
                              />
                            <rect
                              x="10"
                              y="17"
                              width="4"
                              height="4"
                              rx="2"
                              fill="black"
                              />
                          </svg>
                        </span>
                        <!--end::Svg Icon-->
                      </button>
                      <!--begin::Menu-->
                      <div
                        class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary w-175px fw-bold fs-7 py-4"
                        data-kt-menu="true"
                      >
                        <!--begin::Menu item-->
                        <div class="menu-item px-3 d-none">
                          <a
                            href="#kt_modal_user_change_role"
                            class="menu-link px-3"
                            data-bs-toggle="modal"
                          >
                            <%=t('organization.change_role') %>
                          </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <div class="menu-item px-3">
                          <a
                            href="javascript:;"
                            class="menu-link px-3 handle_calendar"
                            data-bs-toggle="modal"
                            member_id="<%= client[:member_id] %>"
                          >
                            <%= client[:enable_calendar] ? t('organization.disable_calendar') : t('organization.enable_calendar') %>
                          </a>
                        </div>
                        <!--end::Menu item-->
                        <!--begin::Menu item-->
                        <% if client[:role] == "member" %>
                        <div class="menu-item px-3">
                          <a
                            href="javascript:void(0)"
                            class="menu-link px-3"
                            data-kt-users-table-filter="delete_row"
                            member_id="<%= client[:member_id] %>"
                          >
                            <%=t('organization.remove_member') %>
                          </a>
                        </div>
                        <% end %>
                        <!--end::Menu item-->
                      </div>
                      <!--end::Menu-->
                    </div>
                  </td>
                </tr>
              <%end %>
              </tbody>
              <!--end::Table body-->
            </table>
            <!--end::Table-->
          </div>
          <!--end::Card body-->
        </div>
        <!--end::Card-->
      </div>
      <!--end::Tab panel-->
    </div>
    <!--end::Tab content-->
  </div>
  <!--end::Container-->
</div>
<!--end::Post-->

<!--begin::Modals-->
<!--begin::Modal - Add user-->
<div
  class="modal fade"
  id="kt_modal_add_user"
  tabindex="-1"
  aria-hidden="true"
>
  <!--begin::Modal dialog-->
  <div class="modal-dialog modal-dialog-centered mw-650px">
    <!--begin::Modal content-->
    <div class="modal-content">
      <!--begin::Modal header-->
      <div
        class="modal-header"
        id="kt_modal_add_user_header"
      >
        <!--begin::Modal title-->
        <h2 class="fw-bolder"><%=t('organization.add_user') %></h2>
        <!--end::Modal title-->
        <!--begin::Close-->
        <button
          type="button"
          class="btn btn-icon btn-sm btn-active-icon-primary"
          data-bs-dismiss="modal"
        >
          <!--begin::Svg Icon | path: icons/duotone/Navigation/Close.svg-->
          <span class="svg-icon svg-icon-1">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="24px"
              height="24px"
              viewBox="0 0 24 24"
              version="1.1"
            >
              <g
                transform="translate(12.000000, 12.000000) rotate(-45.000000) translate(-12.000000, -12.000000) translate(4.000000, 4.000000)"
                fill="#000000"
              >
                <rect
                  fill="#000000"
                  x="0"
                  y="7"
                  width="16"
                  height="2"
                  rx="1"
                  />
                <rect
                  fill="#000000"
                  opacity="0.5"
                  transform="translate(8.000000, 8.000000) rotate(-270.000000) translate(-8.000000, -8.000000)"
                  x="0"
                  y="7"
                  width="16"
                  height="2"
                  rx="1"
                  />
              </g>
            </svg>
          </span>
          <!--end::Svg Icon-->
        </button>
        <!--end::Close-->
      </div>
      <!--end::Modal header-->
      <!--begin::Modal body-->
      <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
        <!--begin::Form-->
        <form
          id="kt_modal_add_user_form"
          class="form"
          method="post"
          action="<%= invite_member_organization_path %>"
        >
          <!--begin::Scroll-->
          <div
            class="d-flex flex-column scroll-y me-n7 pe-7"
            id="kt_modal_add_user_scroll"
            data-kt-scroll="true"
            data-kt-scroll-activate="{default: false, lg: true}"
            data-kt-scroll-max-height="auto"
            data-kt-scroll-dependencies="#kt_modal_add_user_header"
            data-kt-scroll-wrappers="#kt_modal_add_user_scroll"
            data-kt-scroll-offset="300px"
          >
            <!--begin::Input group-->
            <div class="fv-row mb-7">
              <!--begin::Label-->
              <label class="required fw-bold fs-6 mb-2"><%=t('organization.thead.email') %></label>
              <!--end::Label-->
              <!--begin::Input-->
              <input
                type="email"
                name="email"
                class="form-control form-control-solid mb-3 mb-lg-0"
                placeholder="example@domain.com"
                id="add_member_email"
                required
                />
              <!--end::Input-->
            </div>
            <!--end::Input group-->
            <!--begin::Input group-->
            <div class="fv-row mb-7">
              <!--begin::Label-->
              <label class="required fw-bold fs-6 mb-2"><%= t('organization.modal.role') %></label>
              <!--end::Label-->
              <!--begin::Input-->
              <select
                class="form-select form-select-solid"
                data-control="select2"
                data-placeholder="<%= t('organization.modal.select_role') %>"
                name="role"
                id="add_member_role"
              >
                <option></option>
                <option value="1" selected><%= t('organization.modal.member') %></option>
              </select>
              <!--end::Input-->
            </div>
            <!--end::Input group-->
            <!--begin::Input group-->
            <div class="fv-row mb-7">
              <label class="form-check form-check-inline form-check-solid me-5">
                <input
                  class="form-check-input"
                  name="enable_calendar"
                  type="checkbox"
                  id="enable_calendar"
                  />
                <span class="fw-bold ps-2 fs-6"><%= t('organization.modal.enable_calendar') %></span>
              </label>
            </div>
            <!--end::Input group-->
          </div>
          <!--end::Scroll-->
          <!--begin::Actions-->
          <div class="text-center pt-15">
            <button
              type="button"
              class="btn btn-light me-3"
              data-bs-dismiss="modal"
            >
              <%=t('common.button.cancel') %>
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              data-kt-users-modal-action="submit"
            >
              <span class="indicator-label"><%=t('organization.modal.submit') %></span>
              <span class="indicator-progress">
										<%=t('organization.modal.please_wait') %>
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span>
									</span>
            </button>
          </div>
          <!--end::Actions-->
        </form>
        <!--end::Form-->
      </div>
      <!--end::Modal body-->
    </div>
    <!--end::Modal content-->
  </div>
  <!--end::Modal dialog-->
</div>
<!--end::Modal - Add user-->
<!--begin::Modal - Change role-->
<div
  class="modal fade"
  id="kt_modal_user_change_role"
  tabindex="-1"
  aria-hidden="true"
>
  <!--begin::Modal dialog-->
  <div class="modal-dialog modal-dialog-centered mw-650px">
    <!--begin::Modal content-->
    <div class="modal-content">
      <!--begin::Modal header-->
      <div
        class="modal-header"
        id="kt_modal_header_user_change_role"
      >
        <!--begin::Modal title-->
        <h2 class="fw-bolder">Change Role</h2>
        <!--end::Modal title-->
        <!--begin::Close-->
        <button
          type="button"
          class="btn btn-icon btn-sm btn-active-icon-primary"
          data-bs-dismiss="modal"
        >
          <!--begin::Svg Icon | path: icons/duotone/Navigation/Close.svg-->
          <span class="svg-icon svg-icon-1">
								<svg
                  xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink"
                  width="24px"
                  height="24px"
                  viewBox="0 0 24 24"
                  version="1.1"
                >
									<g
                    transform="translate(12.000000, 12.000000) rotate(-45.000000) translate(-12.000000, -12.000000) translate(4.000000, 4.000000)"
                    fill="#000000"
                  >
										<rect
                      fill="#000000"
                      x="0"
                      y="7"
                      width="16"
                      height="2"
                      rx="1"
                      />
										<rect
                      fill="#000000"
                      opacity="0.5"
                      transform="translate(8.000000, 8.000000) rotate(-270.000000) translate(-8.000000, -8.000000)"
                      x="0"
                      y="7"
                      width="16"
                      height="2"
                      rx="1"
                      />
									</g>
								</svg>
							</span>
          <!--end::Svg Icon-->
        </button>
        <!--end::Close-->
      </div>
      <!--end::Modal header-->
      <!--begin::Modal body-->
      <div class="modal-body scroll-y mx-5 mx-xl-15 my-7">
        <!--begin::Form-->
        <form
          id="kt_modal_form_user_change_role"
          class="form"
          action="#"
        >
          <!--begin::Scroll-->
          <div
            class="d-flex flex-column scroll-y me-n7 pe-7"
            id="kt_modal_scroll_user_change_role"
            data-kt-scroll="true"
            data-kt-scroll-activate="{default: false, lg: true}"
            data-kt-scroll-max-height="auto"
            data-kt-scroll-dependencies="#kt_modal_header_user_change_role"
            data-kt-scroll-wrappers="#kt_modal_scroll_user_change_role"
            data-kt-scroll-offset="300px"
          >
            <!--begin::Input group-->
            <div class="fv-row mb-0">
              <!--begin::Label-->
              <label class="required fw-bold fs-6 mb-2">Role</label>
              <!--end::Label-->
              <!--begin::Input-->
              <select
                class="form-select form-select-solid"
                data-control="select2"
                data-placeholder="Select a role"
              >
                <option></option>
                <option
                  value="User"
                  selected
                >User
                </option>
                <option value="Admin">Admin</option>
                <option value="Owner">Owner</option>
              </select>
              <!--end::Input-->
            </div>
            <!--end::Input group-->
          </div>
          <!--end::Scroll-->
          <!--begin::Actions-->
          <div class="text-center pt-15">
            <button
              type="button"
              class="btn btn-light me-3"
              data-bs-dismiss="modal"
            >
              Discard
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              data-kt-users-modal-action="submit"
            >
              <span class="indicator-label">Submit</span>
              <span class="indicator-progress">
										Please wait...
										<span class="spinner-border spinner-border-sm align-middle ms-2"></span>
									</span>
            </button>
          </div>
          <!--end::Actions-->
        </form>
        <!--end::Form-->
      </div>
      <!--end::Modal body-->
    </div>
    <!--end::Modal content-->
  </div>
  <!--end::Modal dialog-->
</div>
<!--end::Modal - Change role-->

<%= render '/modal/update_plan' %>

<script>
    // Team members active table
    (function () {
        // Define shared variables
        const wrapper = document.querySelector('#kt_tab_pane_team_members_active');
        const table = document.querySelector('#kt_table_team_members_active');
        let dataTable;
        let toolbarBase;
        let toolbarSelected;
        let selectedCount;

        // Private functions
        const initTable = function () {
            // Init datatable --- more info on datatables: https://datatables.net/manual/
            dataTable = $(table).DataTable({
                'info': false,
                'order': [],
                'pageLength': 10,
                'lengthChange': false,
                'columnDefs': [
                    {orderable: false, targets: 0}, // Disable ordering on column 0 (checkbox)
                ]
            });

            // Re-init functions on every table re-draw -- more info: https://datatables.net/reference/event/draw
            dataTable.on('draw', function () {
                initToggleToolbar();
                handleDeleteRows();
                toggleToolbars();
            });
        }

        $('.handle_calendar').on('click', function() {
            if (<%= session[:current_organization].chargebee_subscription_plan == "free" %>) $('#kt_modal_upgrade_plan').modal('show');
            else {
                $.ajax({
                    url: "/organization/handle_calendar",
                    type: "POST",
                    data: {
                        member_id: $(this).attr('member_id')
                    },
                    success: function(response){
                        Swal.fire({
                            text: response.message,
                            icon: 'success',
                            buttonsStyling: false,
                            confirmButtonText: "<%= t('sweetalert.ok_got_it') %>",
                            customClass: {
                                confirmButton: 'btn fw-bold btn-primary',
                            }
                        }).then(function () {
                            if (response.success) window.location.reload();
                        });
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            }
        });

        $('#enable_calendar').click(function(e) {
            if (<%= session[:current_organization].chargebee_subscription_plan == "free" %>) {
                $('#kt_modal_upgrade_plan').modal('show');
                e.preventDefault();
            }
        });

        $( "#kt_modal_add_user_form" ).submit(function( event ) {
            event.preventDefault();

            if ($('#add_member_email').val()) {
                $('div.loader-body').show();
                $.ajax({
                    url: "/organization/invite_member",
                    type: "POST",
                    data: {
                        email: $('#add_member_email').val(),
                        role: $('#add_member_role').val(),
                        enable_calendar: $('#enable_calendar').is(':checked') ? true : false
                    },
                    success: function(response){
                        $('div.loader-body').hide();
                        Swal.fire({
                            text: response.message,
                            icon: 'success',
                            buttonsStyling: false,
                            confirmButtonText: "<%= t('sweetalert.ok_got_it') %>",
                            customClass: {
                                confirmButton: 'btn fw-bold btn-primary',
                            }
                        }).then(function () {
                            if (response.success) $("#kt_modal_add_user").modal('hide');
                        });
                    },
                    error: function (error) {
                        $('div.loader-body').hide();
                        console.log(error);
                    }
                });
            }
        });

        // Delete subscirption
        const handleDeleteRows = () => {
            // Select all delete buttons
            const deleteButtons = table.querySelectorAll('[data-kt-users-table-filter="delete_row"]');

            deleteButtons.forEach(d => {
                // Delete button on click
                d.addEventListener('click', function (e) {
                    e.preventDefault();

                    const client_ids = [d.getAttribute('member_id')];

                    // Select parent row
                    const parent = e.target.closest('tr');
                    const userName = parent.querySelectorAll('td')[1].querySelectorAll('a')[0].innerText;

                    // SweetAlert2 pop up --- official docs reference: https://sweetalert2.github.io/
                    Swal.fire({
                        text: '<%= t('common.button.remove_content') %>',
                        icon: 'warning',
                        showCancelButton: true,
                        buttonsStyling: false,
                        confirmButtonText: "<%= t('sweetalert.yes_delete') %>",
                        cancelButtonText: "<%= t('sweetalert.no_cancel') %>",
                        customClass: {
                            confirmButton: 'btn fw-bold btn-danger',
                            cancelButton: 'btn fw-bold btn-active-light-primary'
                        }
                    }).then(function (result) {
                        if (result.value) {
                            remove_clients(client_ids, parent);
                        }
                    });
                })
            });
        }

        const remove_clients = (client_ids, parent) => {
            const userName = parent ? parent.querySelectorAll('td')[1].querySelectorAll('a')[0].innerText : '';

            $.ajax({
                url: "/organization/remove_member",
                type: "POST",
                data: {
                    client_ids: client_ids
                },
                success: function(response){
                    if (response.success) {
                        Swal.fire({
                            text: parent ? ("<%= t('organization.deleted_one') %>" + " " + userName + ".") : "<%= t('organization.deleted_all') %>",
                            icon: 'success',
                            buttonsStyling: false,
                            confirmButtonText: "<%= t('sweetalert.ok_got_it') %>",
                            customClass: {
                                confirmButton: 'btn fw-bold btn-primary',
                            }
                        }).then(function () {
                            if (parent) dataTable.row($(parent)).remove().draw();
                            else {
                                const checkboxes = table.querySelectorAll('[type="checkbox"]');

                                checkboxes.forEach(c => {
                                    if (c.checked) {
                                        dataTable.row($(c.closest('tbody tr'))).remove().draw();
                                    }
                                });
                            }
                        }).then(function () {
                            toggleToolbars(); // Detect checked checkboxes
                            initToggleToolbar(); // Re-init toolbar to recalculate checkboxes
                        });
                    } else {
                        Swal.fire({
                            text: "<%= t('organization.owner_cannot_remove') %>",
                            icon: 'warning',
                            buttonsStyling: false,
                            confirmButtonText: "<%= t('sweetalert.ok_got_it') %>",
                            customClass: {
                                confirmButton: 'btn fw-bold btn-danger'
                            }
                        });
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        };

        // Search Datatable --- official docs reference: https://datatables.net/reference/api/search()
        const handleSearchDatatable = () => {
            const filterSearch = wrapper.querySelector('[data-kt-user-table-filter="search"]');

            filterSearch.addEventListener('keyup', function (e) {
                dataTable.search(e.target.value).draw();
            });
        }

        // Init toggle toolbar
        const initToggleToolbar = () => {
            // Toggle selected action toolbar
            // Select all checkboxes
            const checkboxes = table.querySelectorAll('[type="checkbox"]');

            // Select elements
            toolbarBase = wrapper.querySelector('[data-kt-user-table-toolbar="base"]');
            toolbarSelected = wrapper.querySelector('[data-kt-user-table-toolbar="selected"]');
            selectedCount = wrapper.querySelector('[data-kt-user-table-select="selected_count"]');
            const deleteSelected = wrapper.querySelector('[data-kt-user-table-select="delete_selected"]');

            // Toggle delete selected toolbar
            checkboxes.forEach(c => {
                // Checkbox on click event
                c.addEventListener('click', function () {
                    setTimeout(function () {
                        toggleToolbars();
                    }, 50);
                });
            });

            // Deleted selected rows
            deleteSelected.addEventListener('click', function () {
                // SweetAlert2 pop up --- official docs reference: https://sweetalert2.github.io/
                Swal.fire({
                    text: "<%= t('organization.delete_customer_confirm') %>",
                    icon: 'warning',
                    showCancelButton: true,
                    buttonsStyling: false,
                    confirmButtonText: "<%= t('sweetalert.yes_delete') %>",
                    cancelButtonText: "<%= t('sweetalert.no_cancel') %>",
                    customClass: {
                        confirmButton: 'btn fw-bold btn-danger',
                        cancelButton: 'btn fw-bold btn-active-light-primary'
                    }
                }).then(function (result) {
                    if (result.value) {
                        const client_ids = [];
                        checkboxes.forEach(c => {
                            if (c.checked) {
                                client_ids.push(c.value);
                            }
                        });

                        remove_clients(client_ids, null);
                    }
                });
            });
        }

        // Toggle toolbars
        const toggleToolbars = () => {
            // Select refreshed checkbox DOM elements
            const allCheckboxes = table.querySelectorAll('tbody [type="checkbox"]');

            // Detect checkboxes state & count
            let checkedState = false;
            let count = 0;

            // Count checked boxes
            allCheckboxes.forEach(c => {
                if (c.checked) {
                    checkedState = true;
                    count++;
                }
            });

            // Toggle toolbars
            if (checkedState) {
                selectedCount.innerHTML = count;
                toolbarBase.classList.add('d-none');
                toolbarSelected.classList.remove('d-none');
            } else {
                toolbarBase.classList.remove('d-none');
                toolbarSelected.classList.add('d-none');
            }
        }

        if (table) {
            initTable();
            initToggleToolbar();
            handleSearchDatatable();
            handleDeleteRows();
        }

        $('#kt_table_team_members_active_wrapper').find('.row:nth-child(1)').hide()
    })();
</script>